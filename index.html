<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Favorite words</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        #history > h1:first-child {
            background-color: rgb(231, 231, 241);
        }
        #cursor {
            border-style: none;
            font-size: calc(1.375rem + 1.5vw);
            font-weight: 500;
        }
        input:focus {
            outline-width: 0;
        }
    </style>
  </head>
  <body>
    <div class="row align-items-start pe-1">
        <div class="col" id="imagecol">
            <!-- <img id="image" src=""> -->
            <img id="image" src="" style="max-width: 90%;">
            <img id="thumbnail" src="" style="max-width: 10%;">
        </div>
        <div class="col">
            <div><h1 id="current"></h1></div>
            <div><input id="cursor" type="text" /></div>
            <div id="history"><h1><img id="image" src="" style="max-width: 100px;"></h1></div>
        </div>
      </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        current = document.getElementById("current");
        cursor = document.getElementById("cursor");
        historyContainer = document.getElementById("history");
        imageContainer = document.getElementById("image");
        imageColumn = document.getElementById("imagecol");
        thumbnailContainer = document.getElementById("thumbnail");
        document.onkeypress = function(e) {
            cursor.focus();
        }
        cursor.onkeyup = function (e) {
            e = e || window.event;
            if (e.keyCode == 13) {
                // enter pressed
                clone = current.cloneNode(true);
                clone.id = "clone" + historyContainer.childNodes.length;
                prependHistory(clone);
                // current.innerText = "";
                clone.innerText = cursor.value;
                cursor.value = "";
            } else if (e.keyCode == 32) {
                // space pressed
                // current.innerText += " ";
            } else {
                // current.innerText += e.key;
                specialWord = detectSpecialWord(cursor.value);
                if (specialWord != null) {
                    console.log(specialWord);
                    clone = current.cloneNode(true);
                    clone.id = "clone" + historyContainer.childNodes.length;
                    clone.innerText = specialWord.word;
                    current.innerText = "";
                    cursor.value = "";
                    prependHistory(clone);
                    if (specialWord.color != null) {
                        clone.style = "color: "+specialWord.color+";";
                        current.style = "color: "+specialWord.color+";";
                        imageColumn.style = "background-color: "+specialWord.color+";";
                    }
                    if (specialWord.image != null) {
                        imageContainer.src = specialWord.image;
                        // thumbnail = thumbnailContainer.cloneNode(true);
                        // clone.appendChild(thumbnail);
                        // thumbnail.src = specialWord.image;
                    }
                }
                if (current.innerText.length > 30) {
                    current.innerText = ""
                }
            }
        };
        function prependHistory(element) {
            historyContainer.firstChild.before(element);
        }

        function detectSpecialWord(originalText) {
            text = originalText.toLowerCase();
            for (i in specialWords) {
                entry = specialWords[i];
                substring = text.substring(text.length-entry.word.length)
                if (substring == entry.word) {
                    return entry;
                }
            }
            return null;
        }

        specialWords = []

        function loadDictionary(url) {
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    specialWords = specialWords.concat(data)
                })
                .catch((error) => {
                    console.log(error)
                });
        }

        loadDictionary("https://r5sec5cyl.github.io/key-game/dictionary.json");
        
        sheetsApiKey = "AIzaSyCeDfk2YTrhsd8EvBUpC1MwtRNoZ0vu9xQ";
        
        function loadSheet(sheetUrl, sheetName) {
            sheetId = sheetUrl.split("/d/")[1].split("/")[0];
            apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${sheetsApiKey}`;
            fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                columns = data.values[0]
                console.log(columns);
                for (let i in data.values) {
                    if (i == 0) {
                        continue
                    }
                    element = {};
                    for (let j in data.values[i]) {
                        if (data.values[i][j] == "") {
                            continue;
                        }
                        element[columns[j]] = data.values[i][j];
                        if (columns[j] == "word") {
                            specialWords = specialWords.concat(element);
                        }
                    }
                }
            })
            .catch((error) => {
                console.log(error)
            });
        }
        
        sheetName = "Sheet1"
        sheetsUrl="https://docs.google.com/spreadsheets/d/1U-LMt1c69fsjqt2mVwACwKlga32GW4OJkXqSzT_B21A/edit?gid=0#gid=0"
        loadSheet(sheetsUrl, sheetName);

    </script>
  </body>
</html>
